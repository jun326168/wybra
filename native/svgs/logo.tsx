import React, { useEffect, useMemo } from 'react';
import Svg, { Path, Ellipse, G } from 'react-native-svg';
import Animated, {
  useSharedValue,
  useAnimatedStyle,
  withRepeat,
  withTiming,
  withSequence,
  withDelay,
  Easing,
  useAnimatedProps,
} from 'react-native-reanimated';

const AnimatedG = Animated.createAnimatedComponent(G);

export type LogoPersonality = 'headphone' | 'flower' | 'cloud' | 'tophat' | 'glasses' | 'beanie' | 'sprout';

interface LogoProps {
  size?: number;
  color?: string;
  stroke?: string;
  floatingY?: number;
  personality?: LogoPersonality;
}

// Configuration for each personality including ViewBox, Body Shape, Eye Positions, and Accessory JSX
const PERSONALITY_CONFIG = {
  headphone: {
    width: 231,
    height: 239,
    bodyPath: "M225.472 127.618C225.472 65.8365 176.225 15.7225 115.472 15.7225C54.7192 15.7225 5.47223 65.8256 5.47223 127.618V208.259C5.47223 222.621 20.3332 231.963 32.9722 225.543C37.969 222.997 43.5725 221.84 49.1836 222.196C54.7947 222.552 60.2023 224.407 64.8282 227.564C70.0134 231.105 76.168 233.002 82.4722 233.002C88.7765 233.002 94.9311 231.105 100.116 227.564L103.999 224.934C107.375 222.641 111.375 221.413 115.472 221.413C119.569 221.413 123.57 222.641 126.945 224.934L130.828 227.564C136.013 231.105 142.168 233.002 148.472 233.002C154.776 233.002 160.931 231.105 166.116 227.564C170.743 224.405 176.153 222.548 181.766 222.192C187.38 221.837 192.985 222.995 197.983 225.543C210.611 231.963 225.472 222.621 225.472 208.259V127.618Z",
    eyes: {
      open: { cy: 113, leftCx: 118, rightCx: 171 },
      closed: {
        left: "M103.746 110.575C103.746 110.575 112.074 115.105 118.223 114.985C124.002 114.872 131.665 110.575 131.665 110.575",
        right: "M157.35 110.575C157.35 110.575 165.678 115.105 171.827 114.985C177.606 114.872 185.269 110.575 185.269 110.575"
      }
    },
    renderAccessory: (stroke: string, color: string) => (
      <>
        <Ellipse cx="49.5839" cy="130.98" rx="27.3604" ry="38.6029" fill={stroke} />
        <Path d="M45.1169 101.836C45.1169 101.836 42.4029 74.2918 53.4722 50.2403C64.5416 26.1888 80.4291 18.2403 94.9722 13.2403C109.515 8.24031 126.472 7.77876 141.472 11.2403C156.472 14.7019 169.472 26.7403 169.472 26.7403" stroke={stroke} strokeWidth="18" strokeLinecap="round"/>
        <Ellipse cx="43.4418" cy="130.98" rx="16.7513" ry="25.3676" fill={color} />
      </>
    )
  },
  flower: {
    width: 245,
    height: 229,
    bodyPath: "M239 117.368C239 55.5862 189.753 5.47222 129 5.47222C68.247 5.47222 19 55.5753 19 117.368V198.009C19 212.37 33.861 221.713 46.5 215.293C51.4968 212.746 57.1003 211.589 62.7114 211.945C68.3225 212.301 73.7301 214.157 78.356 217.313C83.5411 220.855 89.6957 222.752 96 222.752C102.304 222.752 108.459 220.855 113.644 217.313L117.527 214.684C120.902 212.391 124.903 211.163 129 211.163C133.097 211.163 137.098 212.391 140.473 214.684L144.356 217.313C149.541 220.855 155.696 222.752 162 222.752C168.304 222.752 174.459 220.855 179.644 217.313C184.271 214.155 189.681 212.298 195.294 211.942C200.907 211.586 206.513 212.744 211.511 215.293C224.139 221.713 239 212.37 239 198.009V117.368Z",
    eyes: {
      open: { cy: 104, leftCx: 131, rightCx: 185 },
      closed: {
        left: "M117.274 100.325C117.274 100.325 125.602 104.855 131.751 104.735C137.53 104.622 145.193 100.325 145.193 100.325",
        right: "M170.878 100.325C170.878 100.325 179.206 104.855 185.355 104.735C191.134 104.622 198.797 100.325 198.797 100.325"
      }
    },
    renderAccessory: (stroke: string) => (
      <Path fillRule="evenodd" clipRule="evenodd" d="M31.6016 45.9551C34.3986 43.1563 37.9534 41.237 41.8278 40.4336C45.7022 39.6302 49.727 39.9778 53.4063 41.4335C57.0856 42.8893 60.2586 45.3896 62.5345 48.6265C64.8103 51.8633 66.0895 55.6952 66.2144 59.6501C71.2414 58.2028 76.6336 58.7608 81.2577 61.2067C85.8818 63.6526 89.3776 67.7959 91.0103 72.7657C92.6265 77.7215 92.2524 83.1181 89.9671 87.803C87.6817 92.488 83.6642 96.1008 78.7638 97.8776C81.6689 102.198 82.7761 107.481 81.8505 112.605C80.9249 117.728 78.0392 122.289 73.8059 125.32C69.5648 128.383 64.3068 129.695 59.1241 128.982C53.9414 128.27 49.2322 125.589 45.9747 121.495C43.9462 124.047 41.3341 126.074 38.3584 127.406C35.3828 128.738 32.1306 129.335 28.876 129.147C25.6214 128.959 22.4595 127.992 19.6567 126.327C16.854 124.662 14.4924 122.347 12.7709 119.579C10.7455 116.308 9.70565 112.523 9.77572 108.677C9.84578 104.83 11.0228 101.086 13.1659 97.8908C8.27751 96.0824 4.27941 92.4511 2.01047 87.7587C-0.258476 83.0663 -0.621917 77.6775 0.996397 72.7229C2.61471 67.7683 6.089 63.633 10.6903 61.1846C15.2917 58.7362 20.6624 58.165 25.6758 59.5908C25.8552 54.4616 27.9728 49.5912 31.6016 45.9616M60.4599 86.4344C60.4599 94.4012 53.9613 100.854 45.9418 100.854C37.9223 100.854 31.4238 94.4012 31.4238 86.4344C31.4238 78.4676 37.9223 72.0151 45.9418 72.0151C53.9613 72.0151 60.4599 78.4676 60.4599 86.4344Z" fill={stroke} />
    )
  },
  cloud: {
    width: 231,
    height: 368,
    bodyPath: "M225.472 256.357C225.472 194.575 176.225 144.461 115.472 144.461C54.7192 144.461 5.47223 194.564 5.47223 256.357V336.997C5.47223 351.359 20.3332 360.702 32.9722 354.281C37.969 351.735 43.5725 350.578 49.1836 350.934C54.7947 351.29 60.2023 353.146 64.8282 356.302C70.0134 359.843 76.168 361.74 82.4722 361.74C88.7765 361.74 94.9311 359.843 100.116 356.302L103.999 353.673C107.375 351.379 111.375 350.151 115.472 350.151C119.569 350.151 123.57 351.379 126.945 353.673L130.828 356.302C136.013 359.843 142.168 361.74 148.472 361.74C154.776 361.74 160.931 359.843 166.116 356.302C170.743 353.144 176.153 351.287 181.766 350.931C187.38 350.575 192.985 351.733 197.983 354.281C210.611 360.702 225.472 351.359 225.472 336.997V256.357Z",
    eyes: {
      open: { cy: 243, leftCx: 118, rightCx: 171 },
      closed: {
        left: "M103.746 239.314C103.746 239.314 112.074 243.844 118.223 243.723C124.002 243.61 131.665 239.314 131.665 239.314",
        right: "M157.35 239.314C157.35 239.314 165.678 243.844 171.827 243.723C177.606 243.61 185.269 239.314 185.269 239.314"
      }
    },
    renderAccessory: (stroke: string) => (
      <Path d="M177.324 53.2925C185.657 55.1914 192.999 60.0914 197.95 67.0576C202.901 74.0238 205.115 82.5688 204.169 91.0628C203.223 99.5568 199.183 107.405 192.82 113.111C186.458 118.817 178.217 121.981 169.671 122H74.0018C63.2178 122.011 52.8144 118.014 44.8113 110.786C36.8081 103.558 31.7763 93.6139 30.6925 82.8845C29.6087 72.155 32.5503 61.4056 38.9463 52.723C45.3423 44.0404 54.7363 38.0441 65.3047 35.8981V35.0284C65.2992 30.4287 66.5098 25.9093 68.8137 21.9282C71.1177 17.9471 74.4332 14.6459 78.4241 12.359C82.4151 10.0722 86.9397 8.88101 91.5393 8.90626C96.139 8.9315 100.65 10.1723 104.616 12.5028C110.719 6.4727 118.475 2.39091 126.901 0.775099C135.327 -0.840708 144.042 0.0822686 151.943 3.42697C159.844 6.77167 166.573 12.3874 171.277 19.5619C175.982 26.7365 178.45 35.1466 178.368 43.7256C178.368 47.0305 178.02 50.1615 177.324 53.2925Z" fill={stroke} />
    )
  },
  tophat: {
    width: 231,
    height: 324,
    bodyPath: "M225.472 212.357C225.472 150.575 176.225 100.461 115.472 100.461C54.7192 100.461 5.47223 150.564 5.47223 212.357V292.997C5.47223 307.359 20.3332 316.702 32.9722 310.281C37.969 307.735 43.5725 306.578 49.1836 306.934C54.7947 307.29 60.2023 309.146 64.8282 312.302C70.0134 315.843 76.168 317.74 82.4722 317.74C88.7765 317.74 94.9311 315.843 100.116 312.302L103.999 309.673C107.375 307.379 111.375 306.151 115.472 306.151C119.569 306.151 123.57 307.379 126.945 309.673L130.828 312.302C136.013 315.843 142.168 317.74 148.472 317.74C154.776 317.74 160.931 315.843 166.116 312.302C170.743 309.144 176.153 307.287 181.766 306.931C187.38 306.575 192.985 307.733 197.983 310.281C210.611 316.702 225.472 307.359 225.472 292.997V212.357Z",
    eyes: {
      open: { cy: 199, leftCx: 118, rightCx: 171 },
      closed: {
        left: "M103.746 195.314C103.746 195.314 112.074 199.844 118.223 199.723C124.002 199.61 131.665 195.314 131.665 195.314",
        right: "M157.35 195.314C157.35 195.314 165.678 199.844 171.827 199.723C177.606 199.61 185.269 195.314 185.269 195.314"
      }
    },
    renderAccessory: (stroke: string) => (
      <Path d="M197.624 111.666C192.967 100.821 181.767 100.424 166.63 102.591C166.745 77.3121 171.004 53.1701 179.096 26.788C182.859 17.3407 154.819 0.184803 115.479 0C76.1382 0.184803 48.0957 17.3379 51.859 26.7852C59.9035 53.0077 64.1344 77.3177 64.2856 102.583C49.1681 100.424 37.9819 100.827 33.3255 111.663C23.1837 131.815 55.2386 168 115.476 168C175.716 168 207.768 131.815 197.624 111.666ZM60.8247 128.36C60.8247 128.36 64.6244 115.074 64.0168 108.048C97.0685 137.796 133.889 137.796 166.938 108.048C167.064 115.216 170.127 128.36 170.127 128.36C137.591 159.32 93.3641 159.32 60.8247 128.36Z" fill={stroke} />
    )
  },
  glasses: {
    width: 231,
    height: 229,
    bodyPath: "M225.472 117.368C225.472 55.5862 176.225 5.47222 115.472 5.47222C54.7192 5.47222 5.47223 55.5753 5.47223 117.368V198.009C5.47223 212.37 20.3332 221.713 32.9722 215.293C37.969 212.746 43.5725 211.589 49.1836 211.945C54.7947 212.301 60.2023 214.157 64.8282 217.313C70.0134 220.855 76.168 222.752 82.4722 222.752C88.7765 222.752 94.9311 220.855 100.116 217.313L103.999 214.684C107.375 212.391 111.375 211.163 115.472 211.163C119.569 211.163 123.57 212.391 126.945 214.684L130.828 217.313C136.013 220.855 142.168 222.752 148.472 222.752C154.776 222.752 160.931 220.855 166.116 217.313C170.743 214.155 176.153 212.298 181.766 211.942C187.38 211.586 192.985 212.744 197.983 215.293C210.611 221.713 225.472 212.37 225.472 198.009V117.368Z",
    eyes: {
      open: { cy: 104, leftCx: 118, rightCx: 171 },
      closed: {
        left: "M103.746 100.325C103.746 100.325 112.074 104.855 118.223 104.735C124.002 104.622 131.665 100.325 131.665 100.325",
        right: "M157.35 100.325C157.35 100.325 165.678 104.855 171.827 104.735C177.606 104.622 185.269 100.325 185.269 100.325"
      }
    },
    renderAccessory: (stroke: string) => (
      <>
        <Path d="M207.472 84.0112H91.4722V99.4778H96.6052L99.6116 126.544H141.147L145.606 99.7968V99.4778C145.606 98.4523 146.013 97.4688 146.738 96.7437C147.463 96.0185 148.447 95.6112 149.472 95.6112C150.498 95.6112 151.481 96.0185 152.206 96.7437C152.932 97.4688 153.339 98.4523 153.339 99.4778V99.7968L157.798 126.544H199.333L202.339 99.4778H207.472V84.0112Z" fill={stroke} />
        <Path d="M92.4722 90.0112H50.4722L42.4722 117.011" stroke={stroke} strokeWidth="11" />
        <Path d="M206.972 90.0112H220.472" stroke={stroke} strokeWidth="11" />
      </>
    )
  },
  beanie: {
    width: 255,
    height: 301,
    bodyPath: "M249 189.357C249 127.575 199.753 77.4611 139 77.4611C78.247 77.4611 29 127.564 29 189.357V269.997C29 284.359 43.861 293.702 56.5 287.281C61.4968 284.735 67.1003 283.578 72.7114 283.934C78.3225 284.29 83.7301 286.146 88.356 289.302C93.5411 292.843 99.6957 294.74 106 294.74C112.304 294.74 118.459 292.843 123.644 289.302L127.527 286.673C130.902 284.379 134.903 283.151 139 283.151C143.097 283.151 147.098 284.379 150.473 286.673L154.356 289.302C159.541 292.843 165.696 294.74 172 294.74C178.304 294.74 184.459 292.843 189.644 289.302C194.271 286.143 199.681 284.287 205.294 283.931C210.907 283.575 216.513 284.733 221.511 287.281C234.139 293.702 249 284.359 249 269.997V189.357Z",
    eyes: {
      open: { cy: 176, leftCx: 141, rightCx: 195 },
      closed: {
        left: "M127.274 172.314C127.274 172.314 135.602 176.844 141.751 176.723C147.53 176.61 155.193 172.314 155.193 172.314",
        right: "M180.878 172.314C180.878 172.314 189.206 176.844 195.355 176.723C201.134 176.61 208.797 172.314 208.797 172.314"
      }
    },
    renderAccessory: (stroke: string) => (
      <Path fillRule="evenodd" clipRule="evenodd" d="M114.373 32.1601C113.695 29.7029 111.579 27.7506 108.49 26.7326C105.4 25.7146 101.59 25.7143 97.8977 26.7318C94.2054 27.7492 90.9332 29.7011 88.8012 32.158C86.6691 34.6149 85.8517 37.3756 86.5287 39.8327C87.2058 42.2898 90.2569 44.4473 90.2569 44.4473C71.3963 52.0002 53.2912 64.2043 43.3137 77.7485C33.3362 91.2928 29.848 105.931 33.4676 119.068L38.6246 137.782L205.687 91.7464L200.53 73.0318C196.91 59.8955 186.416 49.1101 170.909 42.5883C155.402 36.0665 133.709 34.8295 113.641 38.0035C113.641 38.0035 115.05 34.6172 114.373 32.1601ZM40.3025 141.421L205.221 95.976C213.505 93.6934 221.446 96.3098 222.965 101.822L225.714 111.8C227.233 117.313 221.753 123.627 213.47 125.91L48.5511 171.355C44.5745 172.451 40.471 172.45 37.1435 171.354C33.816 170.258 31.5369 168.155 30.8077 165.509L28.0581 155.531C26.5391 150.018 32.0189 143.704 40.3025 141.421Z" fill={stroke} />
    )
  },
  sprout: {
    width: 231,
    height: 304,
    bodyPath: "M225.472 192.357C225.472 130.575 176.225 80.4611 115.472 80.4611C54.7192 80.4611 5.47223 130.564 5.47223 192.357V272.997C5.47223 287.359 20.3332 296.702 32.9722 290.281C37.969 287.735 43.5725 286.578 49.1836 286.934C54.7947 287.29 60.2023 289.146 64.8282 292.302C70.0134 295.843 76.168 297.74 82.4722 297.74C88.7765 297.74 94.9311 295.843 100.116 292.302L103.999 289.673C107.375 287.379 111.375 286.151 115.472 286.151C119.569 286.151 123.57 287.379 126.945 289.673L130.828 292.302C136.013 295.843 142.168 297.74 148.472 297.74C154.776 297.74 160.931 295.843 166.116 292.302C170.743 289.144 176.153 287.287 181.766 286.931C187.38 286.575 192.985 287.733 197.983 290.281C210.611 296.702 225.472 287.359 225.472 272.997V192.357Z",
    eyes: {
      open: { cy: 179, leftCx: 118, rightCx: 171 },
      closed: {
        left: "M103.746 175.314C103.746 175.314 112.074 179.844 118.223 179.723C124.002 179.61 131.665 175.314 131.665 175.314",
        right: "M157.35 175.314C157.35 175.314 165.678 179.844 171.827 179.723C177.606 179.61 185.269 175.314 185.269 175.314"
      }
    },
    renderAccessory: (stroke: string) => (
      <Path d="M172.472 6.9375C172.472 30.3732 155.866 49.9283 133.796 54.5027C132.083 41.9068 126.425 30.5684 118.078 21.7881C126.771 8.67188 141.665 0 158.597 0H165.535C169.372 0 172.472 3.1002 172.472 6.9375ZM61.4722 20.8125C61.4722 16.9752 64.5724 13.875 68.4097 13.875H75.3472C102.165 13.875 123.91 35.6197 123.91 62.4375V104.062C123.91 107.9 120.81 111 116.972 111C113.135 111 110.035 107.9 110.035 104.062V69.375C83.217 69.375 61.4722 47.6303 61.4722 20.8125Z" fill={stroke} />
    )
  }
};

const LogoIcon = ({ size = 120, color = '#EAE8FF', stroke = '#121418', floatingY = 16, personality = 'headphone' }: LogoProps) => {
  const translateY = useSharedValue(0);
  const blink = useSharedValue(0);

  const config = useMemo(() => PERSONALITY_CONFIG[personality] || PERSONALITY_CONFIG.headphone, [personality]);
  const calculatedHeight = size * (config.height / config.width);
  
  if (!personality) personality = 'headphone';

  useEffect(() => {
    // Floating animation
    translateY.value = withRepeat(
      withTiming(-floatingY, {
        duration: 1200,
        easing: Easing.inOut(Easing.ease),
      }),
      -1,
      true
    );

    const blinkDelay = 4000 + Math.random() * 1000;
    // Blinking animation
    blink.value = withRepeat(
      withSequence(
        withDelay(blinkDelay, withTiming(1, { duration: 0 })), // Switch to closed eyes instantly
        withDelay(200, withTiming(0, { duration: 0 }))   // Switch back to open eyes instantly
      ),
      -1,
      false
    );
  }, [translateY, blink, floatingY]);

  const containerStyle = useAnimatedStyle(() => {
    return {
      transform: [{ translateY: translateY.value }],
    };
  });

  const openEyesProps = useAnimatedProps(() => {
    return {
      opacity: blink.value < 0.5 ? 1 : 0,
    };
  });

  const closedEyesProps = useAnimatedProps(() => {
    return {
      opacity: blink.value >= 0.5 ? 1 : 0,
    };
  });

  return (
    <Animated.View style={containerStyle}>
      <Svg width={size} height={calculatedHeight} viewBox={`0 0 ${config.width} ${config.height}`} fill="none">
        {/* Ghost Body */}
        <Path d={config.bodyPath} fill={color} stroke={stroke} strokeWidth="10.9444" strokeLinecap="round" />
        
        {/* Accessory (Hat/Item) */}
        {config.renderAccessory(stroke, color)}

        {/* Open Eyes */}
        <AnimatedG animatedProps={openEyesProps} opacity={1}>
          <Ellipse cx={config.eyes.open.leftCx} cy={config.eyes.open.cy} rx="10" ry="14" fill={stroke} />
          <Ellipse cx={config.eyes.open.rightCx} cy={config.eyes.open.cy} rx="10" ry="14" fill={stroke} />
        </AnimatedG>

        {/* Closed Eyes */}
        <AnimatedG animatedProps={closedEyesProps} opacity={0}>
          <Path d={config.eyes.closed.left} stroke={stroke} strokeWidth="7" strokeLinecap="round" />
          <Path d={config.eyes.closed.right} stroke={stroke} strokeWidth="7" strokeLinecap="round" />
        </AnimatedG>

      </Svg>
    </Animated.View>
  );
};

export default LogoIcon;